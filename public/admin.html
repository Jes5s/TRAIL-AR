<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin | IronLinks</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <h1>Iron <span>works</span> Admin</h1>
    <nav>
      <a href="index.html">Home</a> |
      <a href="admin_booking.html">Bookings</a> |
      <a href="admin.html">Gallery</a>
    </nav>
</header>

<section class="gallery" id="gallery-section">
    <h2>Gallery Management</h2>
    <form id="uploadForm" class="book-form" enctype="multipart/form-data">
        <input type="text" name="category" placeholder="Category (e.g., Gate, Railings)" required>
        <input type="file" name="image" accept="image/*" required>
        <button type="submit">Add Image</button>
    </form>
    <p id="statusMessage" style="color:green;"></p>
    <div id="galleryContainer">
        <h3>Existing Gallery</h3>
        <div class="gallery-grid" id="galleryGrid"></div>
    </div>
</section>

<script>
// -----------------------------
// Load Bookings from Supabase
// -----------------------------
async function loadBookings() {
    try {
        const res = await fetch('/bookings');
        const data = await res.json();
        const tbody = document.querySelector("#bookingsTable tbody");
        tbody.innerHTML = "";
        data.forEach(booking => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${booking.name}</td>
                <td>${booking.email}</td>
                <td>${booking.phone}</td>
                <td>${booking.date}</td>
                <td>${booking.time}</td>
                <td>${booking.request || ''}</td>
            `;
            tbody.appendChild(tr);
        });
    } catch (err) {
        console.error(err);
    }
}

// -----------------------------
// Gallery Upload
// -----------------------------
const uploadForm = document.getElementById('uploadForm');
const statusMessage = document.getElementById('statusMessage');
const galleryGrid = document.getElementById('galleryGrid');

async function loadGallery() {
    try {
        const res = await fetch('/gallery');
        const data = await res.json();
        galleryGrid.innerHTML = '';
        data.forEach(item => {
            const img = document.createElement('img');
            img.src = item.url;
            img.alt = item.category;
            galleryGrid.appendChild(img);
        });
    } catch (err) {
        console.error(err);
    }
}

uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(uploadForm);
    try {
        const res = await fetch('/gallery', { method: 'POST', body: formData });
        const text = await res.text();
        if (!res.ok) throw new Error(text);
        statusMessage.textContent = 'Image added successfully!';
        uploadForm.reset();
        loadGallery();
    } catch (err) {
        statusMessage.style.color = 'red';
        statusMessage.textContent = err.message;
    }
});

// -----------------------------
// Initialize
// -----------------------------
loadBookings();
loadGallery();
</script>

</body>
</html>
